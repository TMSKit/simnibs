<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>File Formats in SimNIBS &#8212; SimNIBS 0) documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=e6165c10"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Coordinates in SimNIBS" href="coordinates.html" />
    <link rel="prev" title="Output Files" href="output_files.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="output_files.html" title="Previous document">Output Files</a>
        </li>
        <li>
          <a href="coordinates.html" title="Next document">Coordinates in SimNIBS</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="file-formats-in-simnibs">
<span id="file-formats"></span><h1>File Formats in SimNIBS<a class="headerlink" href="#file-formats-in-simnibs" title="Link to this heading">¶</a></h1>
<section id="head-models">
<h2>Head Models<a class="headerlink" href="#head-models" title="Link to this heading">¶</a></h2>
<p>SimNIBS’ head models are <strong>meshes</strong> (<em>.msh</em> files).
This means that the head head is represented as a set of <em>Nodes</em> and <em>Elements</em>.</p>
<blockquote>
<div><ul class="simple">
<li><p>The <em>Nodes</em> are points located in the 3-dimensional volume.</p></li>
<li><p>The <em>Elements</em> are triangles and tetrahedra. They are defined using 3 nodes (triangles) or 4 nodes (tetrahedra).</p></li>
</ul>
</div></blockquote>
<p>This type of format is highly advantageous for Finite Element (FEM) calculations, especially for complex geometries such as the human head.</p>
<p>Head Meshes are stored in <strong>binary gmsh version 2 format</strong>, as described in the <a class="reference external" href="http://gmsh.info/doc/texinfo/gmsh.html#MSH-file-format-version-2">Gmsh documentation</a>.
SimNIBS can read arbitrary mesh files.
But it can’t write files with elements other then first order triangles and tetrahedra.</p>
<p>SimNIBS offers the <em>Python</em> <code class="xref py py-func docutils literal notranslate"><span class="pre">simnibs.msh.read_msh()</span></code> function and the
<em>MATLAB</em> function <em>mesh_load_gmsh4</em> to read <em>.msh</em> files.</p>
</section>
<section id="tms-coils">
<h2>TMS Coils<a class="headerlink" href="#tms-coils" title="Link to this heading">¶</a></h2>
<p>Definitions of TMS coils can be stored in a number of different file formats:</p>
<blockquote>
<div><ul class="simple">
<li><p>Dipole files (.ccd) which store the position and magnitude of dipoles</p></li>
<li><p>Files in the NiftI format (.nii | .nii.gz) which store sampled values of the magnetic vector potential (A-field) on a grid</p></li>
<li><p>A combined TMS coil definition file format (.tcd) which can store dipole elements, line segments and a sampled magnetic vector potential (A-field) on a grid. This format also allows for flexible or moveable coil components.</p></li>
</ul>
</div></blockquote>
<section id="tms-coil-definition-file-format-tcd">
<h3>TMS Coil Definition File Format (.tcd)<a class="headerlink" href="#tms-coil-definition-file-format-tcd" title="Link to this heading">¶</a></h3>
<p>The TMS Coil Definition File Format (.tcd) is a JSON-based format that defines a singular TMS coil. The coil file can be loaded into SimNIBS and used to calculate the magnetic vector potential (A-field) and the magnetic induction (B-field) in space resulting from a time-varying current in the coil.</p>
<p>The file format holds basic information about the coil, the name, the brand and the version of the coil file.</p>
<p>For visualization and optimization purposes, the file format contains a list of coil casing triangulated surfaces (“coilModels”). Each coil casing surface has a text description, a point list and a list of faces which are indices into the point list. Additionally, a list of points (“minDistancePoints”) representing the parts of the coil that are supposed to be close to the head can be stored, these are then used for optimization purposes. The point and faces lists are stored as plain text or as Base64 encoded binary.</p>
<p>A list of TMS stimulators (“stimulatorList”) is stored to connect different stimulating coil elements to the same stimulator, which can be used in multi-stimulator coil settings. The TMS stimulators are described by their name, brand, maximum dI/dt in A/s and a list of waveforms.</p>
<p>The main part of the file format is a list of stimulating coil elements, a list of deformations (“deformList”) and a list of deformation ranges (“deformRangeList”). Each stimulating coil element can use one of three types of stimulating elements. Dipoles, which are described by their location, direction and magnitude, line elements, which are defined by their starting position, direction and magnitude or a sampled A-field grid which is described by the A field value at each grid location and an affine transformation matrix. In addition, each stimulating coil element has a name, is connected to one stimulator from the list of stimulators, has an element casing from the list of element casings and is associated with a list of deformations from the general list of deformations that are applied to this coil element. The deformations are applied in the order that they are stored in and each deformation can be applied to multiple stimulating coil elements. A deformation has a text description and is either defined as a translation in the x, y, or z direction or as a rotation around an axis defined by two points. The limits for these deformations are defined as one of the deformation ranges from the general list of deformation ranges. This way, multiple deformations, for example, rotations around different axes, can use the same parameter range.  These ranges are defined by a text description, a minimum and maximum value and an initial value in-between minimum and maximum. These three components allow for definitions of static coils and coils with one or multiple movable stimulating elements.</p>
<p>To complete the definition of a coil, the file format stores information to sample the fields generated by the coil in the form of axis limits (“limits”) and resolution (“resolution”), the possibility for a global coil casing (“coilCasing”) that isn’t associated with a stimulating element and a list of groups of stimulating coil elements (“selfIntersectionTest”) which will be tested for self-intersections in cases of optimization.</p>
<p>Examples on how to create TMS coil definitions in the tcd file format can be found under <code class="file docutils literal notranslate"><span class="pre">simnibs/examples/coils</span></code>.
The JSON schema to validate tcd files can be found under <code class="file docutils literal notranslate"><span class="pre">simnibs/resources/coil_models/coil_model.schema.json</span></code>.</p>
</section>
</section>
<section id="simulation-results">
<h2>Simulation Results<a class="headerlink" href="#simulation-results" title="Link to this heading">¶</a></h2>
<p>By default, Simulation results are also stored in <em>Gmsh</em> format.
There are 2 types of fields used in SimNIBS:</p>
<blockquote>
<div><ul class="simple">
<li><p><em>NodeData</em> is defined at each nodes. By default, only the electric potential “v” is stored as <em>NodeData</em></p></li>
<li><p><em>ElementData</em> is defined for each element. This is the format of choice for the electric field, current density and their respective magnitudes.</p></li>
</ul>
</div></blockquote>
<p>The choice of format for each field is due to how the Finite Element Method works.
After the FEM calculations, we obtain values of “v” at each node.
To obtain the electric field and the current density, we take the gradient of the potential.
However, the gradient operation is defined element-wise, and not node-wise.</p>
<p>Together with the <em>.msh</em> files, we often also save <em>.opt</em> files to facilitate visualization.</p>
</section>
<section id="surface-fields">
<h2>Surface Fields<a class="headerlink" href="#surface-fields" title="Link to this heading">¶</a></h2>
<p>When fields are mapped to the middle gray matter surface, either on the subject or on the  <em>FsAverage</em>, it saves results as a <em>FreeSurfer</em> <em>.curv</em> file, which contains values for each point in the surface. SimNIBS has the <em>mesh_load_fsresults</em> <em>MATLAB</em> function and the <code class="xref py py-func docutils literal notranslate"><span class="pre">simnibs.msh.read_curv()</span></code> <em>Python</em> function to load this kind of file.</p>
<p>The surfaces themselves are stored as GIFTI files in <code class="file docutils literal notranslate"><span class="pre">m2m_</span><em><span class="pre">subID</span></em><span class="pre">/surfaces/</span></code>. They can be read using <em>mesh_load_fssurf</em> in <em>MATLAB</em> and <code class="xref py py-func docutils literal notranslate"><span class="pre">simnibs.msh.read_gifti_surface()</span></code> in <em>Python</em>.</p>
</section>
<section id="volumes">
<h2>Volumes<a class="headerlink" href="#volumes" title="Link to this heading">¶</a></h2>
<p>Fields mapped to subject or MNI volumes are stored in NiftI format.</p>
</section>
<section id="hdf5">
<h2>HDF5<a class="headerlink" href="#hdf5" title="Link to this heading">¶</a></h2>
<p>SimNIBS uses <a class="reference external" href="https://www.hdfgroup.org/solutions/hdf5/">HDF5</a> to store large data sets, such as for uncertainty quantification (UQ) and leadfields.
The HDF5 format is hierarchical, meaning that is acts almost as a folder structure.</p>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="output_files.html" title="Previous document">Output Files</a>
        </li>
        <li>
          <a href="coordinates.html" title="Next document">Coordinates in SimNIBS</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo.png" alt="Logo" />
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset.html">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial.html">Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="documentation.html">Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gui.html">Graphical User Interface Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line/command_line.html">Command Line Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="sim_struct/sim_struct.html">Simulation Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="opt_struct/opt_struct.html">Optimization Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="neuronavigation/neuronavigation.html">Neuronavigation Data Import/Export</a></li>
<li class="toctree-l2"><a class="reference internal" href="output_files.html">Output Files</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">File Formats in SimNIBS</a></li>
<li class="toctree-l2"><a class="reference internal" href="coordinates.html">Coordinates in SimNIBS</a></li>
<li class="toctree-l2"><a class="reference internal" href="conductivity.html">Standard Conductivity Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="coils.html">Coil Models Included in SimNIBS</a></li>
<li class="toctree-l2"><a class="reference internal" href="python_lib/python_lib.html">Python Library Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gallery.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributors.html">Contributors and Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="documentation.html">Documentation</a><ul>
      <li>Previous: <a href="output_files.html" title="previous chapter">Output Files</a></li>
      <li>Next: <a href="coordinates.html" title="next chapter">Coordinates in SimNIBS</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2020, SimNIBS Developers.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/documentation/file_formats.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>